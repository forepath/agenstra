# This file is generated by Nx.
# Build the docker image with `npx nx run backend-agent-manager:agi-container-image`.
# Tip: Modify "agi-container-image" options in project.json to change docker build args.
#
# Run the container with `nx docker:run backend-agent-manager`.
# Uses debian:trixie-slim for smaller image size (~80MB reduction vs full trixie).
#
FROM docker.io/debian:trixie-slim

# Environment variables for openclaw
ENV PORT=18789
ENV OPENCLAW_GATEWAY_TOKEN=
ENV OPENCLAW_HOME=/openclaw
ENV OPENAI_API_KEY=
ENV OPENROUTER_API_KEY=
ENV LITELLM_API_KEY=
ENV LITELLM_MASTER_KEY=
ENV AWS_ACCESS_KEY_ID=
ENV AWS_SECRET_ACCESS_KEY=
ENV AWS_REGION=
ENV AWS_SESSION_TOKEN=
ENV AWS_PROFILE=
ENV AWS_BEARER_TOKEN_BEDROCK=
ENV AI_GATEWAY_API_KEY=
ENV MOONSHOT_API_KEY=
ENV MINIMAX_API_KEY=
ENV OPENCODE_API_KEY=
ENV ZAI_API_KEY=
ENV SYNTHETIC_API_KEY=

# Set working directory
WORKDIR /openclaw

# Expose ports for the backend API and WebSocket
EXPOSE ${PORT}

# Install all system dependencies in a single layer for better caching
# Note: trixie-slim may not include all packages, so we explicitly install them
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    curl \
    bash \
    ca-certificates \
    gnupg \
    lsb-release

# Install openclaw globally
RUN mkdir -p /openclaw && \
  curl -fsSL https://openclaw.ai/install.sh | bash -s -- --no-onboard

# Keep container running (use docker exec to get bash session)
CMD [ "openclaw", "gateway", "--allow-unconfigured" ]
