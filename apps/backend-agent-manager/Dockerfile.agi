# This file is generated by Nx.
# Build the docker image with `npx nx run backend-agent-manager:agi-container-image`.
# Tip: Modify "agi-container-image" options in project.json to change docker build args.
#
# Run the container with `nx docker:run backend-agent-manager -p 18789:18789`.
# Exposes OpenClaw gateway on port 18789 (HTTP + WebSocket).
# Access the Control UI at http://localhost:18789/
# The gateway token can be configured via OPENCLAW_GATEWAY_TOKEN environment variable.
#
# AGI container for running OpenClaw as a pre-configured AI agent.
# Model provider keys (e.g. ANTHROPIC_API_KEY) can be passed via environment variables.
#
FROM docker.io/alpine/openclaw:latest

# Environment variables for OpenClaw gateway
ENV OPENCLAW_GATEWAY_PORT=18789
ENV OPENCLAW_GATEWAY_BIND=0.0.0.0
ENV HOME=/home/node

# Create directories for config and workspace (persisted via volume mounts at runtime)
RUN mkdir -p /home/node/.openclaw /home/node/.openclaw/workspace && \
    chown -R node:node /home/node/.openclaw

# Switch to non-root user
USER node

WORKDIR /home/node

# Expose OpenClaw gateway port (HTTP + WebSocket for Control UI and chat)
EXPOSE 18789

# Start OpenClaw gateway with --allow-unconfigured for headless startup
# Config can be provided via mounted volume or OPENCLAW_* env vars at runtime
CMD ["node", "dist/index.js", "gateway", "--bind", "0.0.0.0", "--port", "18789", "--allow-unconfigured"]
