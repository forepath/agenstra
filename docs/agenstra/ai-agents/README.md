# AI Agents Context (.agenstra)

This section describes how to use the `.agenstra/` directory to configure AI coding assistants (Cursor, OpenCode, GitHub Copilot) from a single, tool-agnostic source.

## Overview

The `.agenstra/` context is a **single source of truth** for agent rules, commands, skills, agents, and tools. The `@agenstra/ai` transformer reads this directory and emits tool-specific configs so you can maintain one set of files and generate Cursor, OpenCode, and GitHub Copilot output as needed.

**Key characteristics**:

- **Tool-agnostic** – No vendor-specific syntax in the source files
- **Composable** – Rules, commands, skills, and agents are separate and reusable
- **Versionable** – Commit `.agenstra/` to git and share across the team
- **Transform on demand** – Generate tool configs with `nx` or the transformer API

## Directory Structure

```
.agenstra/
├── metadata.json          # Project metadata (required: version, appName; optional: description). Only appName is passed to context.
├── rules/                 # Instruction-based rules (.mdc)
├── commands/              # Reusable prompts (.command.mdc)
├── skills/                # Reusable skill docs (.skill.mdc)
├── agents/                # Primary agent configs (.agent.mdc)
├── subagents/             # Subagent configs (.subagent.mdc)
├── mcp-definitions/       # MCP server definitions (JSON)
└── overrides/             # Manual overrides (copied last, can overwrite generated content)
    ├── .cursor/           # Cursor-specific overrides
    ├── .opencode/         # OpenCode-specific overrides
    ├── .github/           # GitHub Copilot-specific overrides
    ├── AGENTS.md          # Override OpenCode AGENTS.md
    └── opencode.json      # Override OpenCode config
```

## Components

### [Rules](./rules.md)

Project-wide instructions (coding standards, architecture, testing, security). Stored as **MDC** (`.mdc`) in `rules/`. Transformed into Cursor rules (`.mdc`), OpenCode `AGENTS.md` (aggregated), and GitHub Copilot repository instructions.

### [Commands](./commands.md)

Reusable slash-style commands with prompts and optional agent binding. Stored as **MDC** (`.command.mdc`) in `commands/` (YAML frontmatter + body as prompt). Transformed into Cursor commands (`.md`) and OpenCode commands (`.md` with frontmatter). The transformer does not emit commands for GitHub Copilot; configure Copilot separately if needed.

### [Skills](./skills.md)

Domain-specific knowledge (patterns, best practices) as **MDC** (`.skill.mdc`) in `skills/`. Tools that support skills get them as separate files; others receive skills merged into rules or instructions.

### [Agents](./agents.md)

Primary agents and subagents defined as **MDC** (YAML frontmatter + body) in `agents/` (`.agent.mdc`) and `subagents/` (`.subagent.mdc`). Frontmatter includes id, name, description, mode, temperature, model, tools; body is the prompt/instructions. Transformed into Cursor agents (`.md`), OpenCode agents (`.md`), and GitHub Copilot instructions (`.github/instructions/agents.instructions.md` with both agents and subagents; Copilot has no native subagent config).

### [MCP definitions](./mcp-definitions.md)

Model Context Protocol server definitions (local command or remote URL) in `mcp-definitions/`. Transformed into Cursor `.cursor/mcp.json` (single `mcpServers` object) and OpenCode `opencode.json` (`mcp` object).

### Overrides

Manual overrides in `overrides/` are copied to the output directory **after** transformation, allowing you to overwrite or extend auto-generated content. Override structure mirrors the output structure:

- `.agenstra/overrides/.cursor/...` → copied to `outputDir/.cursor/...` (Cursor)
- `.agenstra/overrides/.opencode/...` → copied to `outputDir/.opencode/...` (OpenCode)
- `.agenstra/overrides/AGENTS.md` → copied to `outputDir/AGENTS.md` (OpenCode)
- `.agenstra/overrides/opencode.json` → copied to `outputDir/opencode.json` (OpenCode)
- `.agenstra/overrides/.github/...` → copied to `outputDir/.github/...` (GitHub Copilot)

Use overrides to:

- Customize generated files without modifying `.agenstra/` source
- Add tool-specific files not generated by the transformer
- Override specific generated files (e.g., custom `AGENTS.md` for OpenCode)

## Generating tool configs

After editing `.agenstra/`, generate output for one or more tools:

**Via Nx** (if the project has an `agenstra-transform` target):

```bash
nx run my-app:agenstra-transform --target=cursor,opencode,github-copilot --outputDir=generated
```

**Via API**:

```ts
import { transform } from '@agenstra/ai';

transform({
  source: '.agenstra',
  target: ['cursor', 'opencode', 'github-copilot'],
  outputDir: 'generated',
  dryRun: false,
});
```

Output is written under `outputDir/<tool>/` (e.g. `generated/cursor/`, `generated/opencode/`, `generated/github-copilot/`). Copy or symlink the generated folders into your project root as needed (e.g. `generated/cursor/.cursor` → `.cursor`).

## Related documentation

- **[Applications](../applications/README.md)** – Backend and frontend applications

---

_For detailed component schemas and examples, see the individual documentation pages._
