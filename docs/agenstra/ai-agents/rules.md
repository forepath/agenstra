# Rules

Project-wide instructions for AI agents: coding standards, architecture, testing, and security. Stored as **MDC** (`.mdc`) in `.agenstra/rules/`.

## Purpose

Rules provide persistent context so the AI follows your project’s conventions. They are transformed into tool-specific formats (Cursor `.mdc`, OpenCode aggregated `AGENTS.md`, GitHub Copilot repository instructions).

## Structure

- **Location**: `.agenstra/rules/`
- **Format**: MDC (`.mdc`) – YAML frontmatter + body
- **Naming**: Any descriptive name (e.g. `coding-standards.mdc`, `architecture.mdc`, `testing.mdc`, `security.mdc`)

Each file is a standalone document. The transformer uses the **filename stem** (without `.mdc`) as the rule key. The **body** (content below the frontmatter) is the rule content emitted by the transformers.

## Frontmatter (metadata)

Optional metadata between `---` is read by the reader and used by transformers.

| Field         | Type     | Description                                                                                                                                                                                      |
| ------------- | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `id`          | string   | Optional identifier (key is filename stem)                                                                                                                                                       |
| `name`        | string   | Optional display name                                                                                                                                                                            |
| `description` | string   | Optional short description (used by Cursor; otherwise derived from content)                                                                                                                      |
| `globs`       | string[] | Glob patterns for file/path scope. **Cursor**: "Apply to Specific Files". **GitHub Copilot**: path-specific instructions (applyTo is autogenerated from globs). Default: `[]` (repository-wide). |
| `alwaysApply` | boolean  | When `true`, rule is always applied (Cursor: "Always Apply"). When `true`, `globs` is inferred as `['**']` so GitHub Copilot treats the rule as repository-wide. Default: `false`.               |

## Content guidelines

- **Focused** – One concern per file (e.g. coding standards, architecture, testing).
- **Actionable** – Prefer concrete instructions over vague guidance.
- **Stable** – Avoid duplicating code; reference canonical examples or docs instead.

## Examples

### Basic rule (repository-wide)

```mdc
---
id: coding-standards
name: Coding Standards
description: Conventions, structure, and error handling
---
# Coding Standards

## Conventions

- Use strict mode where the language supports it
- Prefer immutability; avoid unnecessary mutation
- Use consistent indentation (document in project README)

## Structure

- Keep business logic in a dedicated layer
- Mirror test layout to source layout where possible
```

### Cursor: Always-apply rule

```mdc
---
id: project-conventions
name: Project Conventions
alwaysApply: true
---
# Project Conventions

Always follow these conventions in all code.
```

### File-specific rule (Cursor + GitHub Copilot)

Rules with `globs` are scoped to matching files. Cursor uses them for "Apply to Specific Files"; GitHub Copilot emits path-specific `.instructions.md` with `applyTo` autogenerated from the same globs.

```mdc
---
id: typescript-standards
name: TypeScript Standards
globs: ["**/*.ts", "**/*.tsx"]
---
# TypeScript Standards

TypeScript-specific conventions and patterns.
```

## Output by tool

- **Cursor** – One `.mdc` file per rule under `.cursor/rules/` with frontmatter (`description`, `globs`, `alwaysApply`). Rules with `globs` set are configured for "Apply to Specific Files"; rules with `alwaysApply: true` are set to "Always Apply".
- **OpenCode** – All rules aggregated into a single `AGENTS.md` (project instructions). `globs` and `alwaysApply` are ignored.
- **GitHub Copilot** – Rules without `globs`, with empty `globs`, or with `globs: ['**']` (e.g. from `alwaysApply: true`) are merged into `.github/copilot-instructions.md`. Rules with other `globs` are emitted as path-specific `.github/instructions/<name>.instructions.md` files; `applyTo` is autogenerated from the rule’s `globs` (comma-separated).

## Related

- [Agents](./agents.md) – Agents can reference rules
- [README](./README.md) – Overview of `.agenstra/` and transformation
