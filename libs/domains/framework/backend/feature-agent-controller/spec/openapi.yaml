openapi: 3.1.0
info:
  title: Agent Controller API
  version: 1.0.0
  description: HTTP API for managing clients and proxied agent operations
  contact:
    name: ForePath
    email: hi@forepath.io
    url: https://forepath.io
servers:
  - url: http://localhost:3100/api
    description: Local development
security:
  - bearerAuth: []
paths:
  /auth/login:
    post:
      summary: Login (users auth only)
      operationId: login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginDto'
      responses:
        '200':
          description: JWT access token and user info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials or email not confirmed
  /auth/register:
    post:
      summary: Register new user (users auth only)
      description: |
        Registers a new user. When DISABLE_SIGNUP is true, returns 503 Service Unavailable.
      operationId: register
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterDto'
      responses:
        '201':
          description: User created (first user auto-confirmed, others receive 6-character alphanumeric confirmation code via email)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
        '409':
          description: Email already registered
        '503':
          description: Signup is disabled (DISABLE_SIGNUP=true)
  /auth/confirm-email:
    post:
      summary: Confirm email with 6-character code (users auth only)
      operationId: confirmEmail
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfirmEmailDto'
      responses:
        '200':
          description: Email confirmed
        '400':
          description: Invalid or expired confirmation code
  /auth/request-password-reset:
    post:
      summary: Request password reset (users auth only)
      operationId: requestPasswordReset
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestPasswordResetDto'
      responses:
        '200':
          description: If an account exists with this email, a 6-character password reset code will be sent
  /auth/reset-password:
    post:
      summary: Reset password with 6-character code (users auth only)
      operationId: resetPassword
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordDto'
      responses:
        '200':
          description: Password reset
        '400':
          description: Invalid or expired reset code
  /auth/change-password:
    post:
      summary: Change password (authenticated users)
      operationId: changePassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordDto'
      responses:
        '200':
          description: Password changed
        '400':
          description: Passwords do not match or invalid
        '401':
          description: Current password incorrect
  /users:
    get:
      summary: List users (admin only)
      operationId: listUsers
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
      responses:
        '200':
          description: Array of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponseDto'
    post:
      summary: Create user (admin only)
      operationId: createUser
      description: >
        Creates a new user. First user is auto-confirmed. Non-first users receive a
        confirmation email (same as self-registration); they must confirm before logging in.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserDto'
      responses:
        '201':
          description: User created (first user auto-confirmed, others receive confirmation email)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponseDto'
        '409':
          description: Email already exists
  /users/{id}:
    get:
      summary: Get user by id (admin only)
      operationId: getUser
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponseDto'
        '404':
          description: User not found
    post:
      summary: Update user (admin only)
      operationId: updateUser
      description: >
        Updates a user. When email is changed, the account is set unconfirmed and a
        confirmation email is sent to the new address (same as self-registration).
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserDto'
      responses:
        '200':
          description: User updated (email change triggers confirmation email to new address)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponseDto'
        '404':
          description: User not found
    delete:
      summary: Delete user (admin only)
      operationId: deleteUser
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: User deleted
        '404':
          description: User not found
  /clients:
    get:
      summary: List clients
      description: |
        Returns all clients the user has access to. In api-key mode, returns all clients.
        For regular users, only returns clients where:
        - The user is the creator (user_id matches)
        - The user is in the client_users relationship table
        Global admins see all clients.
      operationId: listClients
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
          description: Maximum number of clients to return (default 10)
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
          description: Number of clients to skip (default 0)
      responses:
        '200':
          description: Array of clients
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ClientResponseDto'
    post:
      summary: Create client
      description: |
        Creates a new client. The user_id is automatically set to the logged-in user.
        In api-key mode, user_id is set to null.
      operationId: createClient
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateClientDto'
      responses:
        '201':
          description: Created client with generated API key (if applicable)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateClientResponseDto'
  /clients/{id}:
    get:
      summary: Get client by id
      description: |
        Returns a client by ID. Only accessible if the user has access to the client.
        Access is granted if:
        - The user is a global admin
        - The user is the creator (user_id matches)
        - The user is in the client_users relationship table
        In api-key mode, access is always granted.
      operationId: getClient
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Client
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientResponseDto'
        '403':
          description: User does not have access to this client
    post:
      summary: Update client
      description: |
        Updates a client. Only accessible if the user has access to the client.
        Access rules are the same as GET /clients/{id}.
      operationId: updateClient
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateClientDto'
      responses:
        '200':
          description: Updated client
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientResponseDto'
        '403':
          description: User does not have access to this client
    delete:
      summary: Delete client
      description: |
        Deletes a client. Only accessible if the user has access to the client.
        Access rules are the same as GET /clients/{id}.
      operationId: deleteClient
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Deleted
        '403':
          description: User does not have access to this client
  /clients/{id}/users:
    get:
      summary: List users associated with a client
      description: |
        Returns all users associated with a client through the client_users relationship table.
        Only accessible if the user has access to the client.
        Note: In api-key mode, users do not play a role; this endpoint is intended for keycloak and users authentication.
      operationId: getClientUsers
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
      responses:
        '200':
          description: Array of client-user relationships
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ClientUserResponseDto'
        '403':
          description: User does not have access to this client
    post:
      summary: Add a user to a client
      description: |
        Adds a user to a client by email address. The user is identified by their email.
        Permissions:
        - Global admins can add any role
        - Client creators can add any role
        - Client admins can only add 'user' role
        - Client users cannot add anyone
        Note: In api-key mode, users do not play a role; this endpoint is not applicable. Use keycloak or users authentication.
      operationId: addClientUser
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddClientUserDto'
      responses:
        '201':
          description: User added to client
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientUserResponseDto'
        '400':
          description: User not found, relationship already exists, or permission denied
        '403':
          description: User does not have access to this client
  /clients/{id}/users/{relationshipId}:
    delete:
      summary: Remove a user from a client
      description: |
        Removes a user from a client by deleting the client_users relationship.
        Permissions:
        - Global admins can remove anyone
        - Client creators can remove anyone
        - Client admins can remove users (but not other admins)
        - Client users cannot remove anyone
        Note: In api-key mode, users do not play a role; this endpoint is not applicable. Use keycloak or users authentication.
      operationId: removeClientUser
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: relationshipId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client_users relationship to remove
      responses:
        '204':
          description: User removed from client
        '400':
          description: Relationship not found or permission denied
        '403':
          description: User does not have access to this client
  /clients/{id}/agents:
    get:
      summary: List agents for a client
      operationId: listClientAgents
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
          description: Maximum number of agents to return (default 10)
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
          description: Number of agents to skip (default 0)
      responses:
        '200':
          description: Array of agents
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AgentResponseDto'
        '403':
          description: User does not have access to this client
    post:
      summary: Create agent for a client
      operationId: createClientAgent
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAgentDto'
      responses:
        '201':
          description: Created agent with generated password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateAgentResponseDto'
        '403':
          description: User does not have access to this client
  /clients/{id}/agents/{agentId}:
    get:
      summary: Get agent by id for a client
      operationId: getClientAgent
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      responses:
        '200':
          description: Agent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponseDto'
        '403':
          description: User does not have access to this client
    post:
      summary: Update agent for a client
      operationId: updateClientAgent
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAgentDto'
      responses:
        '200':
          description: Updated agent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponseDto'
        '403':
          description: User does not have access to this client
    delete:
      summary: Delete agent for a client
      operationId: deleteClientAgent
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent to delete
      responses:
        '204':
          description: Deleted
        '403':
          description: User does not have access to this client
  /clients/{id}/agents/{agentId}/files:
    get:
      summary: List directory contents (proxied)
      operationId: listClientAgentDirectory
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: query
          name: path
          schema:
            type: string
          description: Directory path relative to /app (defaults to '.')
      responses:
        '200':
          description: Array of file nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FileNodeDto'
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or directory not found
  /clients/{id}/agents/{agentId}/files/{path}:
    get:
      summary: Read file content (proxied)
      operationId: readClientAgentFile
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: path
          required: true
          schema:
            type: string
          description: File path relative to /app (supports nested paths)
      responses:
        '200':
          description: File content (base64-encoded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileContentDto'
        '400':
          description: Invalid path
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or file not found
    put:
      summary: Write file content (proxied)
      operationId: writeClientAgentFile
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: path
          required: true
          schema:
            type: string
          description: File path relative to /app (supports nested paths)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WriteFileDto'
      responses:
        '204':
          description: File written successfully
        '400':
          description: Invalid path or content too large
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
    delete:
      summary: Delete file or directory (proxied)
      operationId: deleteClientAgentFileOrDirectory
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: path
          required: true
          schema:
            type: string
          description: File or directory path relative to /app (supports nested paths)
      responses:
        '204':
          description: File or directory deleted successfully
        '400':
          description: Invalid path
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or file/directory not found
    patch:
      summary: Move file or directory (proxied)
      operationId: moveClientAgentFileOrDirectory
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: path
          required: true
          schema:
            type: string
          description: Source file or directory path relative to /app (supports nested paths)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MoveFileDto'
      responses:
        '204':
          description: File or directory moved successfully
        '400':
          description: Invalid path or destination
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or source file/directory not found
    post:
      summary: Create file or directory (proxied)
      operationId: createClientAgentFileOrDirectory
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: path
          required: true
          schema:
            type: string
          description: File or directory path relative to /app (supports nested paths)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFileDto'
      responses:
        '201':
          description: File or directory created
        '400':
          description: Invalid request
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
  /clients/{id}/agents/{agentId}/environment:
    get:
      summary: List environment variables for an agent (proxied)
      operationId: listClientAgentEnvironmentVariables
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
          description: Maximum number of environment variables to return (default 50)
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
          description: Number of environment variables to skip (default 0)
      responses:
        '200':
          description: Array of environment variables
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EnvironmentVariableResponseDto'
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
    post:
      summary: Create environment variable for an agent (proxied)
      operationId: createClientAgentEnvironmentVariable
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEnvironmentVariableDto'
      responses:
        '201':
          description: Created environment variable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvironmentVariableResponseDto'
        '400':
          description: Invalid request
        '404':
          description: Client or agent not found
    delete:
      summary: Delete all environment variables for an agent (proxied)
      operationId: deleteAllClientAgentEnvironmentVariables
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      responses:
        '200':
          description: Number of environment variables deleted
          content:
            application/json:
              schema:
                type: object
                required: [deletedCount]
                properties:
                  deletedCount:
                    type: integer
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
  /clients/{id}/agents/{agentId}/environment/count:
    get:
      summary: Get count of environment variables for an agent (proxied)
      operationId: countClientAgentEnvironmentVariables
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      responses:
        '200':
          description: Count of environment variables
          content:
            application/json:
              schema:
                type: object
                required: [count]
                properties:
                  count:
                    type: integer
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
  /clients/{id}/agents/{agentId}/environment/{envVarId}:
    put:
      summary: Update environment variable for an agent (proxied)
      operationId: updateClientAgentEnvironmentVariable
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: envVarId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the environment variable to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEnvironmentVariableDto'
      responses:
        '200':
          description: Updated environment variable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvironmentVariableResponseDto'
        '400':
          description: Invalid request
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or environment variable not found
    delete:
      summary: Delete environment variable for an agent (proxied)
      operationId: deleteClientAgentEnvironmentVariable
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: envVarId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the environment variable to delete
      responses:
        '204':
          description: Environment variable deleted successfully
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or environment variable not found
  /clients/{id}/agents/{agentId}/vcs/status:
    get:
      summary: Get git status (proxied)
      operationId: getClientAgentGitStatus
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      responses:
        '200':
          description: Git status information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitStatusDto'
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
  /clients/{id}/agents/{agentId}/vcs/branches:
    get:
      summary: List all branches (proxied)
      operationId: getClientAgentGitBranches
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      responses:
        '200':
          description: Array of branch information
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GitBranchDto'
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
    post:
      summary: Create a new branch (proxied)
      operationId: createClientAgentGitBranch
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBranchDto'
      responses:
        '201':
          description: Branch created successfully
        '400':
          description: Invalid branch name or parameters
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
  /clients/{id}/agents/{agentId}/vcs/branches/{branch}:
    delete:
      summary: Delete a branch (proxied)
      operationId: deleteClientAgentGitBranch
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: branch
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Branch deleted successfully
        '400':
          description: Cannot delete current branch
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or branch not found
  /clients/{id}/agents/{agentId}/vcs/branches/{branch}/switch:
    post:
      summary: Switch to a branch (proxied)
      operationId: switchClientAgentGitBranch
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: branch
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Branch switched successfully
        '400':
          description: Invalid branch or uncommitted changes
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or branch not found
  /clients/{id}/agents/{agentId}/vcs/diff:
    get:
      summary: Get file diff (proxied)
      operationId: getClientAgentGitFileDiff
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: query
          name: path
          required: true
          schema:
            type: string
          description: File path relative to repository root
      responses:
        '200':
          description: File diff information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitDiffDto'
        '400':
          description: Invalid file path
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or file not found
  /clients/{id}/agents/{agentId}/vcs/stage:
    post:
      summary: Stage files (proxied)
      operationId: stageClientAgentFiles
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StageFilesDto'
      responses:
        '204':
          description: Files staged successfully
        '400':
          description: Invalid file paths
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
  /clients/{id}/agents/{agentId}/vcs/unstage:
    post:
      summary: Unstage files (proxied)
      operationId: unstageClientAgentFiles
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UnstageFilesDto'
      responses:
        '204':
          description: Files unstaged successfully
        '400':
          description: Invalid file paths
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
  /clients/{id}/agents/{agentId}/vcs/commit:
    post:
      summary: Commit staged changes (proxied)
      operationId: commitClientAgentChanges
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommitDto'
      responses:
        '204':
          description: Changes committed successfully
        '400':
          description: No staged changes or invalid commit message
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
  /clients/{id}/agents/{agentId}/vcs/push:
    post:
      summary: Push changes to remote (proxied)
      operationId: pushClientAgentChanges
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PushOptionsDto'
      responses:
        '204':
          description: Changes pushed successfully
        '400':
          description: Nothing to push or push failed
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
  /clients/{id}/agents/{agentId}/vcs/pull:
    post:
      summary: Pull changes from remote (proxied)
      operationId: pullClientAgentChanges
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      responses:
        '204':
          description: Changes pulled successfully
        '400':
          description: Pull failed or conflicts
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
  /clients/{id}/agents/{agentId}/vcs/fetch:
    post:
      summary: Fetch changes from remote (proxied)
      operationId: fetchClientAgentChanges
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      responses:
        '204':
          description: Changes fetched successfully
        '403':
          description: User does not have access to this client
        '404':
          description: Client or agent not found
  /clients/{id}/agents/{agentId}/vcs/rebase:
    post:
      summary: Rebase current branch (proxied)
      operationId: rebaseClientAgentBranch
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RebaseDto'
      responses:
        '204':
          description: Rebase completed successfully
        '400':
          description: Rebase failed or conflicts
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or branch not found
  /clients/{id}/agents/{agentId}/vcs/conflicts/resolve:
    post:
      summary: Resolve merge conflict (proxied)
      operationId: resolveClientAgentConflict
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResolveConflictDto'
      responses:
        '204':
          description: Conflict resolved successfully
        '400':
          description: Invalid conflict resolution strategy
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or file not found
  /clients/provisioning/providers:
    get:
      summary: List available provisioning providers
      operationId: listProvisioningProviders
      responses:
        '200':
          description: Array of available provisioning providers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProvisioningProviderInfo'
  /clients/provisioning/providers/{providerType}/server-types:
    get:
      summary: Get available server types for a provisioning provider
      operationId: getServerTypes
      parameters:
        - in: path
          name: providerType
          required: true
          schema:
            type: string
            enum: [hetzner, digital-ocean]
          description: The provisioning provider type (e.g., 'hetzner', 'digital-ocean')
      responses:
        '200':
          description: Array of server types with specifications and pricing
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ServerType'
        '400':
          description: Provider type not found or invalid
  /clients/provisioning/provision:
    post:
      summary: Provision a new server and create a client
      operationId: provisionServer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProvisionServerDto'
      responses:
        '201':
          description: Provisioned server with client information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProvisionedServerResponseDto'
        '400':
          description: Invalid request or provisioning failed
  /clients/{id}/provisioning/info:
    get:
      summary: Get server information for a provisioned client
      operationId: getServerInfo
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
      responses:
        '200':
          description: Server information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerInfo'
        '404':
          description: No provisioning reference found for client or client not found
  /clients/{id}/provisioning:
    delete:
      summary: Delete a provisioned server and its associated client
      operationId: deleteProvisionedServer
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
      responses:
        '204':
          description: Server and client deleted successfully
        '400':
          description: No provisioning reference found for client
        '404':
          description: Client not found
  /clients/{id}/agents/{agentId}/deployments/configuration:
    get:
      summary: Get deployment configuration for an agent (proxied)
      operationId: getClientAgentDeploymentConfiguration
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      responses:
        '200':
          description: Deployment configuration
          content:
            application/json:
              schema:
                type: object
        '404':
          description: Client, agent, or deployment configuration not found
    post:
      summary: Create or update deployment configuration for an agent (proxied)
      operationId: upsertClientAgentDeploymentConfiguration
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Deployment configuration created or updated
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Invalid request
        '404':
          description: Client or agent not found
    delete:
      summary: Delete deployment configuration for an agent (proxied)
      operationId: deleteClientAgentDeploymentConfiguration
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      responses:
        '204':
          description: Deployment configuration deleted successfully
        '404':
          description: Client, agent, or deployment configuration not found
  /clients/{id}/agents/{agentId}/deployments/repositories:
    get:
      summary: List repositories accessible with the agent's deployment configuration (proxied)
      operationId: listClientAgentDeploymentRepositories
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      responses:
        '200':
          description: Array of repositories
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or deployment configuration not found
  /clients/{id}/agents/{agentId}/deployments/repositories/{repositoryId}/branches:
    get:
      summary: List branches for a repository (proxied)
      operationId: listClientAgentDeploymentBranches
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: repositoryId
          required: true
          schema:
            type: string
          description: Repository identifier (e.g., 'owner/repo' for GitHub)
      responses:
        '200':
          description: Array of branches
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '403':
          description: User does not have access to this client
        '404':
          description: Client, agent, or deployment configuration not found
  /clients/{id}/agents/{agentId}/deployments/repositories/{repositoryId}/workflows:
    get:
      summary: List workflows for a repository (proxied)
      operationId: listClientAgentDeploymentWorkflows
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: repositoryId
          required: true
          schema:
            type: string
          description: Repository identifier (e.g., 'owner/repo' for GitHub)
        - in: query
          name: branch
          schema:
            type: string
          description: Branch name (optional, defaults to default branch)
      responses:
        '200':
          description: Array of workflows
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '404':
          description: Client, agent, or deployment configuration not found
  /clients/{id}/agents/{agentId}/deployments/workflows/trigger:
    post:
      summary: Trigger a workflow run (proxied)
      operationId: triggerClientAgentDeploymentWorkflow
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Workflow run triggered
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Invalid request
        '404':
          description: Client, agent, or deployment configuration not found
  /clients/{id}/agents/{agentId}/deployments/runs:
    get:
      summary: List deployment runs for an agent (proxied)
      operationId: listClientAgentDeploymentRuns
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
          description: Maximum number of runs to return (default 50)
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
          description: Number of runs to skip (default 0)
      responses:
        '200':
          description: Array of deployment runs
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '404':
          description: Client, agent, or deployment configuration not found
  /clients/{id}/agents/{agentId}/deployments/runs/{runId}:
    get:
      summary: Get the status of a pipeline run (proxied)
      operationId: getClientAgentDeploymentRunStatus
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: runId
          required: true
          schema:
            type: string
          description: Provider-specific run identifier
      responses:
        '200':
          description: Pipeline run status
          content:
            application/json:
              schema:
                type: object
        '404':
          description: Client, agent, deployment configuration, or run not found
  /clients/{id}/agents/{agentId}/deployments/runs/{runId}/logs:
    get:
      summary: Get logs for a pipeline run (proxied)
      operationId: getClientAgentDeploymentRunLogs
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: runId
          required: true
          schema:
            type: string
          description: Provider-specific run identifier
      responses:
        '200':
          description: Pipeline run logs
          content:
            application/json:
              schema:
                type: object
                required: [logs]
                properties:
                  logs:
                    type: string
                    description: Pipeline run logs as string
        '404':
          description: Client, agent, deployment configuration, or run not found
  /clients/{id}/agents/{agentId}/deployments/runs/{runId}/jobs:
    get:
      summary: List jobs/steps for a pipeline run (proxied)
      operationId: listClientAgentDeploymentRunJobs
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: runId
          required: true
          schema:
            type: string
          description: Provider-specific run identifier
      responses:
        '200':
          description: Array of jobs/steps
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '404':
          description: Client, agent, deployment configuration, or run not found
  /clients/{id}/agents/{agentId}/deployments/runs/{runId}/jobs/{jobId}/logs:
    get:
      summary: Get logs for a specific job/step (proxied)
      operationId: getClientAgentDeploymentJobLogs
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: runId
          required: true
          schema:
            type: string
          description: Provider-specific run identifier
        - in: path
          name: jobId
          required: true
          schema:
            type: string
          description: Job identifier
      responses:
        '200':
          description: Job logs
          content:
            application/json:
              schema:
                type: object
                required: [logs]
                properties:
                  logs:
                    type: string
                    description: Job logs as string
        '404':
          description: Client, agent, deployment configuration, run, or job not found
  /clients/{id}/agents/{agentId}/deployments/runs/{runId}/cancel:
    post:
      summary: Cancel a running pipeline (proxied)
      operationId: cancelClientAgentDeploymentRun
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: path
          name: agentId
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the agent
        - in: path
          name: runId
          required: true
          schema:
            type: string
          description: Provider-specific run identifier
      responses:
        '204':
          description: Pipeline cancelled successfully
        '404':
          description: Client, agent, deployment configuration, or run not found
  /clients/{id}/statistics/summary:
    get:
      summary: Get statistics summary for a client
      description: |
        Returns aggregate statistics (messages, words, chars, filter drops) for a client.
        Requires access to the client (creator, client_users, or admin/api-key).
      operationId: getClientStatisticsSummary
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: The UUID of the client
        - in: query
          name: from
          schema:
            type: string
            format: date-time
          description: Start of time range (ISO 8601)
        - in: query
          name: to
          schema:
            type: string
            format: date-time
          description: End of time range (ISO 8601)
        - in: query
          name: groupBy
          schema:
            type: string
            enum: [day, hour]
          description: Optional time-series aggregation
      responses:
        '200':
          description: Statistics summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsSummaryDto'
        '403':
          description: Access denied to this client
  /clients/{id}/statistics/chat-io:
    get:
      summary: Get chat I/O records for a client
      operationId: getClientStatisticsChatIo
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: query
          name: agentId
          schema:
            type: string
            format: uuid
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: direction
          schema:
            type: string
            enum: [input, output]
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
        - in: query
          name: search
          schema:
            type: string
          description: Case-insensitive search across id, direction, wordCount, charCount
      responses:
        '200':
          description: Paginated chat I/O records
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsChatIoListDto'
        '403':
          description: Access denied to this client
  /clients/{id}/statistics/filter-drops:
    get:
      summary: Get filter drops for a client
      operationId: getClientStatisticsFilterDrops
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: query
          name: agentId
          schema:
            type: string
            format: uuid
        - in: query
          name: filterType
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
        - in: query
          name: search
          schema:
            type: string
          description: Case-insensitive search across filterType, filterDisplayName, filterReason, direction
      responses:
        '200':
          description: Paginated filter drops
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsFilterDropListDto'
        '403':
          description: Access denied to this client
  /clients/{id}/statistics/filter-flags:
    get:
      summary: Get filter flags for a client
      description: |
        Returns paginated filter flags (messages flagged/modified by filters but NOT dropped).
        These messages were allowed through (possibly modified) and appear in Chat I/O.
      operationId: getClientStatisticsFilterFlags
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: query
          name: agentId
          schema:
            type: string
            format: uuid
        - in: query
          name: filterType
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
        - in: query
          name: search
          schema:
            type: string
          description: Case-insensitive search across filterType, filterDisplayName, filterReason, direction
      responses:
        '200':
          description: Paginated filter flags
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsFilterFlagListDto'
        '403':
          description: Access denied to this client
  /clients/{id}/statistics/entity-events:
    get:
      summary: Get entity lifecycle events for a client
      operationId: getClientStatisticsEntityEvents
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - in: query
          name: entityType
          schema:
            type: string
            enum: [user, client, agent, client_user, provisioning_reference]
        - in: query
          name: eventType
          schema:
            type: string
            enum: [created, updated, deleted]
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
        - in: query
          name: search
          schema:
            type: string
          description: Case-insensitive search across entityType, eventType, originalEntityId
      responses:
        '200':
          description: Paginated entity events
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsEntityEventListDto'
        '403':
          description: Access denied to this client
  /statistics/summary:
    get:
      summary: Get aggregate statistics summary
      description: |
        Returns aggregate statistics across all accessible clients. When clientId is provided,
        validates access and returns data for that client only. 403 when clientId provided but no access.
      operationId: getStatisticsSummary
      parameters:
        - in: query
          name: clientId
          schema:
            type: string
            format: uuid
          description: Optional client filter; must be accessible
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: groupBy
          schema:
            type: string
            enum: [day, hour]
      responses:
        '200':
          description: Statistics summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsSummaryDto'
        '403':
          description: Access denied to requested client
  /statistics/chat-io:
    get:
      summary: Get chat I/O records (aggregate or by client)
      operationId: getStatisticsChatIo
      parameters:
        - in: query
          name: clientId
          schema:
            type: string
            format: uuid
        - in: query
          name: agentId
          schema:
            type: string
            format: uuid
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: direction
          schema:
            type: string
            enum: [input, output]
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
        - in: query
          name: search
          schema:
            type: string
          description: Case-insensitive search across id, direction, wordCount, charCount
      responses:
        '200':
          description: Paginated chat I/O records
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsChatIoListDto'
        '403':
          description: Access denied to requested client
  /statistics/filter-drops:
    get:
      summary: Get filter drops (aggregate or by client)
      operationId: getStatisticsFilterDrops
      parameters:
        - in: query
          name: clientId
          schema:
            type: string
            format: uuid
        - in: query
          name: agentId
          schema:
            type: string
            format: uuid
        - in: query
          name: filterType
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
        - in: query
          name: search
          schema:
            type: string
          description: Case-insensitive search across filterType, filterDisplayName, filterReason, direction
      responses:
        '200':
          description: Paginated filter drops
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsFilterDropListDto'
        '403':
          description: Access denied to requested client
  /statistics/filter-flags:
    get:
      summary: Get filter flags (aggregate or by client)
      description: |
        Returns paginated filter flags (messages flagged/modified by filters but NOT dropped).
        These messages were allowed through (possibly modified) and appear in Chat I/O.
      operationId: getStatisticsFilterFlags
      parameters:
        - in: query
          name: clientId
          schema:
            type: string
            format: uuid
        - in: query
          name: agentId
          schema:
            type: string
            format: uuid
        - in: query
          name: filterType
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
        - in: query
          name: search
          schema:
            type: string
          description: Case-insensitive search across filterType, filterDisplayName, filterReason, direction
      responses:
        '200':
          description: Paginated filter flags
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsFilterFlagListDto'
        '403':
          description: Access denied to requested client
  /statistics/entity-events:
    get:
      summary: Get entity events (aggregate or by client)
      operationId: getStatisticsEntityEvents
      parameters:
        - in: query
          name: clientId
          schema:
            type: string
            format: uuid
        - in: query
          name: entityType
          schema:
            type: string
            enum: [user, client, agent, client_user, provisioning_reference]
        - in: query
          name: eventType
          schema:
            type: string
            enum: [created, updated, deleted]
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 0
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
        - in: query
          name: search
          schema:
            type: string
          description: Case-insensitive search across entityType, eventType, originalEntityId
      responses:
        '200':
          description: Paginated entity events
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsEntityEventListDto'
        '403':
          description: Access denied to requested client
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    AuthenticationType:
      type: string
      enum:
        - api_key
        - keycloak
    AuthenticationMethod:
      type: string
      enum:
        - api-key
        - keycloak
        - users
      description: Server authentication method (api-key, keycloak, or users)
    LoginDto:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
    RegisterDto:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
    ConfirmEmailDto:
      type: object
      required: [email, code]
      properties:
        email:
          type: string
          format: email
          description: User's email address
        code:
          type: string
          pattern: '^[A-Z0-9]{6}$'
          description: 6-character alphanumeric confirmation code from email (A-Z, 0-9)
    RequestPasswordResetDto:
      type: object
      required: [email]
      properties:
        email:
          type: string
          format: email
    ResetPasswordDto:
      type: object
      required: [email, code, newPassword]
      properties:
        email:
          type: string
          format: email
          description: User's email address
        code:
          type: string
          pattern: '^[A-Z0-9]{6}$'
          description: 6-character alphanumeric reset code from email (A-Z, 0-9)
        newPassword:
          type: string
          minLength: 8
    ChangePasswordDto:
      type: object
      required: [currentPassword, newPassword, newPasswordConfirmation]
      properties:
        currentPassword:
          type: string
        newPassword:
          type: string
          minLength: 8
        newPasswordConfirmation:
          type: string
          minLength: 8
    LoginResponse:
      type: object
      required: [access_token, user]
      properties:
        access_token:
          type: string
          description: JWT bearer token
        user:
          type: object
          required: [id, email, role]
          properties:
            id:
              type: string
              format: uuid
            email:
              type: string
            role:
              $ref: '#/components/schemas/UserRole'
    RegisterResponse:
      type: object
      required: [user, message]
      properties:
        user:
          type: object
          required: [id, email, role]
          properties:
            id:
              type: string
              format: uuid
            email:
              type: string
            role:
              $ref: '#/components/schemas/UserRole'
        message:
          type: string
    UserRole:
      type: string
      enum:
        - user
        - admin
    UserResponseDto:
      type: object
      required: [id, email, role, createdAt, updatedAt]
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        role:
          $ref: '#/components/schemas/UserRole'
        emailConfirmedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    CreateUserDto:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        role:
          $ref: '#/components/schemas/UserRole'
    UpdateUserDto:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        role:
          $ref: '#/components/schemas/UserRole'
    ClientResponseDto:
      type: object
      required:
        [
          id,
          name,
          endpoint,
          authenticationType,
          isAutoProvisioned,
          createdAt,
          updatedAt,
        ]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        endpoint:
          type: string
          format: uri
        authenticationType:
          $ref: '#/components/schemas/AuthenticationType'
        agentWsPort:
          type: integer
          minimum: 1
          maximum: 65535
          description: Optional Socket.IO port for the client's agents gateway
        config:
          $ref: '#/components/schemas/ConfigResponseDto'
          description: Configuration from the agent-manager instance (optional, may be undefined if agent-manager is unreachable)
        isAutoProvisioned:
          type: boolean
          description: Indicates whether the client was auto-provisioned via server provisioning. Used to determine if server info endpoints should be called.
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    CreateClientDto:
      type: object
      required: [name, endpoint, authenticationType]
      properties:
        name:
          type: string
        description:
          type: string
        endpoint:
          type: string
          format: uri
        authenticationType:
          $ref: '#/components/schemas/AuthenticationType'
        apiKey:
          type: string
          description: API key (optional, will be auto-generated if not provided for API_KEY type)
        keycloakClientId:
          type: string
          description: Keycloak client ID (required for KEYCLOAK authentication type)
        keycloakClientSecret:
          type: string
          description: Keycloak client secret (required for KEYCLOAK authentication type)
        keycloakRealm:
          type: string
          description: Keycloak realm (optional, uses environment default if not provided)
        agentWsPort:
          type: integer
          minimum: 1
          maximum: 65535
          description: Optional Socket.IO port for the client's agents gateway (defaults to 8080 if not set)
    UpdateClientDto:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        endpoint:
          type: string
          format: uri
        authenticationType:
          $ref: '#/components/schemas/AuthenticationType'
        apiKey:
          type: string
          description: API key (can be updated but will never be included in responses)
        keycloakClientId:
          type: string
          description: Keycloak client ID
        keycloakClientSecret:
          type: string
          description: Keycloak client secret
        keycloakRealm:
          type: string
          description: Keycloak realm
        agentWsPort:
          type: integer
          minimum: 1
          maximum: 65535
          description: Optional Socket.IO port for the client's agents gateway
    CreateClientResponseDto:
      allOf:
        - $ref: '#/components/schemas/ClientResponseDto'
        - type: object
          properties:
            apiKey:
              type: string
              description: The API key for the client (only for API_KEY authentication type, only returned once during creation)
    CreateAgentDto:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        gitRepositoryUrl:
          type: [string, 'null']
          description: Git repository URL to clone when creating the agent
        createVirtualWorkspace:
          type: boolean
          default: true
          description: Whether to create a VNC virtual workspace container (defaults to true)
        createSshConnection:
          type: boolean
          default: true
          description: Whether to create an SSH connection container (defaults to true)
    UpdateAgentDto:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
    AgentResponseDto:
      type: object
      required: [id, name, createdAt, updatedAt]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        git:
          type: [object, 'null']
          properties:
            repositoryUrl:
              type: string
              description: Git repository URL associated with the agent
          description: Git information (only present if gitRepositoryUrl is set)
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    CreateAgentResponseDto:
      allOf:
        - $ref: '#/components/schemas/AgentResponseDto'
        - type: object
          required: [password]
          properties:
            password:
              type: string
    AgentTypeInfo:
      type: object
      required: [type, displayName]
      properties:
        type:
          type: string
          description: The unique type identifier (e.g., 'cursor', 'openai', 'anthropic')
        displayName:
          type: string
          description: Human-readable display name (e.g., 'Cursor', 'OpenAI', 'Anthropic Claude')
    ConfigResponseDto:
      type: object
      required: [agentTypes]
      properties:
        gitRepositoryUrl:
          type: [string, 'null']
          description: Git repository URL used for cloning repositories when creating agents
        agentTypes:
          type: array
          items:
            $ref: '#/components/schemas/AgentTypeInfo'
          description: Array of available agent provider types with display names
    FileContentDto:
      type: object
      required: [content, encoding]
      properties:
        content:
          type: string
          description: File content as base64-encoded string (supports both text and binary files)
        encoding:
          type: string
          enum: [utf-8, base64]
          description: Encoding indicator - 'utf-8' for text files, 'base64' for binary files
    FileNodeDto:
      type: object
      required: [name, type, path]
      properties:
        name:
          type: string
          description: File or directory name
        type:
          type: string
          enum: [file, directory]
          description: Node type
        path:
          type: string
          description: Relative path from /app
        size:
          type: [integer, 'null']
          description: File size in bytes (only for files)
        modifiedAt:
          type: [string, 'null']
          format: date-time
          description: Last modification timestamp
    WriteFileDto:
      type: object
      required: [content]
      properties:
        content:
          type: string
          description: File content as base64-encoded string (supports both text and binary files)
        encoding:
          type: string
          enum: [utf-8, base64]
          description: Optional encoding indicator - 'utf-8' for text files, 'base64' for binary files (defaults to 'utf-8')
    CreateFileDto:
      type: object
      required: [type]
      properties:
        type:
          type: string
          enum: [file, directory]
          description: Type of node to create
        content:
          type: [string, 'null']
          description: Optional content for file creation (base64-encoded)
    MoveFileDto:
      type: object
      required: [destination]
      properties:
        destination:
          type: string
          description: Destination path relative to /app (supports nested paths)
    GitStatusDto:
      type: object
      required:
        [
          currentBranch,
          isClean,
          hasUnpushedCommits,
          aheadCount,
          behindCount,
          files,
        ]
      properties:
        currentBranch:
          type: string
          description: Current branch name
        isClean:
          type: boolean
          description: Whether the working tree is clean (no changes)
        hasUnpushedCommits:
          type: boolean
          description: Whether there are unpushed commits (ahead of remote)
        aheadCount:
          type: integer
          description: Number of commits ahead of remote
        behindCount:
          type: integer
          description: Number of commits behind remote
        files:
          type: array
          items:
            $ref: '#/components/schemas/GitFileStatusDto'
          description: List of files with their git status
    GitFileStatusDto:
      type: object
      required: [path, status, type]
      properties:
        path:
          type: string
          description: File path relative to repository root
        status:
          type: string
          description: Git status code (e.g., 'M', 'A', 'D', '??', 'MM', etc.)
        type:
          type: string
          enum: [staged, unstaged, untracked, both]
          description: Status type
        isBinary:
          type: boolean
          description: Whether this is a binary file
        size:
          type: integer
          description: File size in bytes (for binary files)
    GitBranchDto:
      type: object
      required: [name, ref, isCurrent, isRemote, commit, message]
      properties:
        name:
          type: string
          description: Branch name (without refs/heads/ prefix)
        ref:
          type: string
          description: Full branch reference (e.g., 'refs/heads/main')
        isCurrent:
          type: boolean
          description: Whether this is the current branch
        isRemote:
          type: boolean
          description: Whether this is a remote branch
        remote:
          type: string
          description: Remote name (if remote branch)
        commit:
          type: string
          description: Commit hash (short)
        message:
          type: string
          description: Commit message (first line)
        aheadCount:
          type: integer
          description: Number of commits ahead of remote (for local branches)
        behindCount:
          type: integer
          description: Number of commits behind remote (for local branches)
    GitDiffDto:
      type: object
      required: [path, originalContent, modifiedContent, encoding, isBinary]
      properties:
        path:
          type: string
          description: File path relative to repository root
        originalContent:
          type: string
          description: Original file content (base64-encoded for text, empty for binary)
        modifiedContent:
          type: string
          description: Modified file content (base64-encoded for text, empty for binary)
        encoding:
          type: string
          enum: [utf-8, base64]
          description: Encoding indicator
        isBinary:
          type: boolean
          description: Whether this is a binary file
        originalSize:
          type: integer
          description: Original file size in bytes (for binary files)
        modifiedSize:
          type: integer
          description: Modified file size in bytes (for binary files)
    StageFilesDto:
      type: object
      required: [files]
      properties:
        files:
          type: array
          items:
            type: string
          description: Array of file paths to stage (empty array stages all)
    UnstageFilesDto:
      type: object
      required: [files]
      properties:
        files:
          type: array
          items:
            type: string
          description: Array of file paths to unstage (empty array unstages all)
    CommitDto:
      type: object
      required: [message]
      properties:
        message:
          type: string
          description: Commit message
    PushOptionsDto:
      type: object
      properties:
        force:
          type: boolean
          description: >
            When true, performs a `git push --force-with-lease`. Defaults to false.
    CreateBranchDto:
      type: object
      required: [name]
      properties:
        name:
          type: string
          description: Branch name (will be prefixed with conventional commit prefix if useConventionalPrefix is true)
        useConventionalPrefix:
          type: boolean
          description: Whether to use conventional commit prefix (feat/, fix/, chore/, etc.)
        conventionalType:
          type: string
          enum: [feat, fix, chore, docs, style, refactor, test, perf]
          description: Conventional commit type (only used if useConventionalPrefix is true)
        baseBranch:
          type: string
          description: Base branch to create from (defaults to current branch)
    RebaseDto:
      type: object
      required: [branch]
      properties:
        branch:
          type: string
          description: Branch name to rebase onto
    ResolveConflictDto:
      type: object
      required: [path, strategy]
      properties:
        path:
          type: string
          description: File path with conflict (relative to repository root)
        strategy:
          type: string
          enum: [yours, mine, both]
          description: Merge strategy - 'yours' (accept incoming), 'mine' (accept current), 'both' (keep both)
    ProvisioningProviderInfo:
      type: object
      required: [type, displayName]
      properties:
        type:
          type: string
          enum: [hetzner, digital-ocean]
          description: The unique provider type identifier (e.g., 'hetzner', 'digital-ocean')
        displayName:
          type: string
          description: Human-readable display name (e.g., 'Hetzner Cloud', 'DigitalOcean')
    ServerType:
      type: object
      required: [id, name, cores, memory, disk]
      properties:
        id:
          type: string
          description: Unique identifier for the server type (e.g., 'cx11', 'cpx11')
        name:
          type: string
          description: Human-readable name (e.g., 'CX11', 'CPX11')
        cores:
          type: integer
          description: Number of CPU cores
        memory:
          type: number
          description: Amount of RAM in GB
        disk:
          type: integer
          description: Disk size in GB
        priceMonthly:
          type: number
          description: Price per month in EUR (or provider's currency)
        priceHourly:
          type: number
          description: Price per hour in EUR (or provider's currency)
        description:
          type: string
          description: Additional description or notes
    ProvisionServerDto:
      type: object
      required: [providerType, serverType, name, authenticationType]
      properties:
        providerType:
          type: string
          enum: [hetzner, digital-ocean]
          description: The provisioning provider type (e.g., 'hetzner', 'digital-ocean')
        serverType:
          type: string
          description: Server type identifier (e.g., 'cx11', 'cpx11' for Hetzner; 's-1vcpu-1gb', 's-2vcpu-2gb' for DigitalOcean)
        name:
          type: string
          description: Server name/label
        description:
          type: string
          description: Optional description
        location:
          type: string
          description: Location/datacenter identifier (e.g., 'nbg1', 'fsn1' for Hetzner; 'fra1', 'nyc3' for DigitalOcean)
        authenticationType:
          $ref: '#/components/schemas/AuthenticationType'
        apiKey:
          type: string
          description: API key (optional, will be auto-generated if not provided for API_KEY type)
        keycloakClientId:
          type: string
          description: Keycloak client ID (required for KEYCLOAK authentication type)
        keycloakClientSecret:
          type: string
          description: Keycloak client secret (required for KEYCLOAK authentication type)
        keycloakRealm:
          type: string
          description: Keycloak realm (optional, uses environment default if not provided)
        agentWsPort:
          type: integer
          minimum: 1
          maximum: 65535
          description: Optional Socket.IO port for the client's agents gateway (defaults to 8080 if not set)
    ProvisionedServerResponseDto:
      allOf:
        - $ref: '#/components/schemas/ClientResponseDto'
        - type: object
          required: [providerType, serverId, serverName, publicIp, serverStatus]
          properties:
            providerType:
              type: string
              enum: [hetzner, digital-ocean]
              description: Provider type used for provisioning (e.g., 'hetzner', 'digital-ocean')
            serverId:
              type: string
              description: Provider-specific server ID
            serverName:
              type: string
              description: Server name
            publicIp:
              type: string
              description: Public IP address of the server
            privateIp:
              type: string
              description: Private IP address of the server (if applicable)
            serverStatus:
              type: string
              description: Server status (e.g., 'running', 'starting')
    ServerInfo:
      type: object
      required: [serverId, providerType]
      properties:
        serverId:
          type: string
          description: Provider-specific server ID
        serverName:
          type: string
          description: Server name
        publicIp:
          type: string
          description: Public IP address of the server
        privateIp:
          type: string
          description: Private IP address of the server (if applicable)
        serverStatus:
          type: string
          description: Server status (e.g., 'running', 'starting')
        providerType:
          type: string
          enum: [hetzner, digital-ocean]
          description: Provider type used for provisioning (e.g., 'hetzner', 'digital-ocean')
    CreateEnvironmentVariableDto:
      type: object
      required: [variable, content]
      properties:
        variable:
          type: string
          description: Environment variable name
        content:
          type: string
          description: Environment variable content
    UpdateEnvironmentVariableDto:
      type: object
      required: [variable, content]
      properties:
        variable:
          type: string
          description: Environment variable name
        content:
          type: string
          description: Environment variable content
    EnvironmentVariableResponseDto:
      type: object
      required: [id, agentId, variable, content, createdAt, updatedAt]
      properties:
        id:
          type: string
          format: uuid
        agentId:
          type: string
          format: uuid
        variable:
          type: string
        content:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    AddClientUserDto:
      type: object
      required: [email, role]
      properties:
        email:
          type: string
          format: email
          description: Email address of the user to add
        role:
          type: string
          enum: [admin, user]
          description: Role for the user in this client (admin or user)
    ClientUserResponseDto:
      type: object
      required: [id, userId, clientId, role, createdAt, updatedAt]
      properties:
        id:
          type: string
          format: uuid
          description: The UUID of the client_users relationship
        userId:
          type: string
          format: uuid
          description: The UUID of the user
        clientId:
          type: string
          format: uuid
          description: The UUID of the client
        role:
          type: string
          enum: [admin, user]
          description: Role for the user in this client
        userEmail:
          type: string
          format: email
          description: Email address of the user
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    StatisticsSummaryDto:
      type: object
      required:
        [
          totalMessages,
          totalWords,
          totalChars,
          avgWordsPerMessage,
          filterDropCount,
          filterTypesBreakdown,
        ]
      properties:
        totalMessages:
          type: integer
        totalWords:
          type: integer
        totalChars:
          type: integer
        avgWordsPerMessage:
          type: number
        filterDropCount:
          type: integer
        filterTypesBreakdown:
          type: array
          items:
            type: object
            required: [filterType, direction, count]
            properties:
              filterType:
                type: string
              direction:
                type: string
                enum: [incoming, outgoing]
              count:
                type: integer
        filterFlagCount:
          type: integer
          description: Count of messages flagged/modified (excluding dropped)
        filterFlagsBreakdown:
          type: array
          items:
            type: object
            required: [filterType, direction, count]
            properties:
              filterType:
                type: string
              direction:
                type: string
                enum: [incoming, outgoing]
              count:
                type: integer
        series:
          type: array
          items:
            type: object
            properties:
              period:
                type: string
                format: date-time
              count:
                type: integer
              wordCount:
                type: integer
              charCount:
                type: integer
    StatisticsChatIoDto:
      type: object
      required: [id, clientId, direction, wordCount, charCount, occurredAt]
      properties:
        id:
          type: string
          format: uuid
        clientId:
          type: string
          format: uuid
        agentId:
          type: string
          format: uuid
        clientName:
          type: string
          description: Client name for display; link to chat when agentId present
        agentName:
          type: string
          description: Agent name for display; link to chat when agentId present
        originalUserId:
          type: string
          format: uuid
          description: Original user ID from identity system; use to resolve user email
        direction:
          type: string
          enum: [input, output]
        wordCount:
          type: integer
        charCount:
          type: integer
        occurredAt:
          type: string
          format: date-time
    StatisticsChatIoListDto:
      type: object
      required: [data, total, limit, offset]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/StatisticsChatIoDto'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
    StatisticsFilterDropDto:
      type: object
      required:
        [
          id,
          clientId,
          filterType,
          filterDisplayName,
          direction,
          wordCount,
          charCount,
          occurredAt,
        ]
      properties:
        id:
          type: string
          format: uuid
        clientId:
          type: string
          format: uuid
        agentId:
          type: string
          format: uuid
        clientName:
          type: string
          description: Client name for display; link to chat when agentId present
        agentName:
          type: string
          description: Agent name for display; link to chat when agentId present
        originalUserId:
          type: string
          format: uuid
          description: Original user ID from identity system; use to resolve user email
        filterType:
          type: string
        filterDisplayName:
          type: string
        filterReason:
          type: string
        direction:
          type: string
          enum: [incoming, outgoing]
        wordCount:
          type: integer
        charCount:
          type: integer
        occurredAt:
          type: string
          format: date-time
    StatisticsFilterDropListDto:
      type: object
      required: [data, total, limit, offset]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/StatisticsFilterDropDto'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
    StatisticsFilterFlagDto:
      type: object
      required:
        [
          id,
          clientId,
          filterType,
          filterDisplayName,
          direction,
          wordCount,
          charCount,
          occurredAt,
        ]
      properties:
        id:
          type: string
          format: uuid
        clientId:
          type: string
          format: uuid
        agentId:
          type: string
          format: uuid
        clientName:
          type: string
          description: Client name for display; link to chat when agentId present
        agentName:
          type: string
          description: Agent name for display; link to chat when agentId present
        originalUserId:
          type: string
          format: uuid
          description: Original user ID from identity system; use to resolve user email
        filterType:
          type: string
        filterDisplayName:
          type: string
        filterReason:
          type: string
        direction:
          type: string
          enum: [incoming, outgoing]
        wordCount:
          type: integer
        charCount:
          type: integer
        occurredAt:
          type: string
          format: date-time
    StatisticsFilterFlagListDto:
      type: object
      required: [data, total, limit, offset]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/StatisticsFilterFlagDto'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
    StatisticsEntityEventDto:
      type: object
      required: [id, entityType, eventType, originalEntityId, occurredAt]
      properties:
        id:
          type: string
          format: uuid
        entityType:
          type: string
          enum: [user, client, agent, client_user, provisioning_reference]
        eventType:
          type: string
          enum: [created, updated, deleted]
        originalEntityId:
          type: string
          format: uuid
        originalUserId:
          type: string
          format: uuid
          description: Original user ID of the actor who performed the event
        clientId:
          type: string
          format: uuid
          description: Client ID for agent events; link to chat when agentId present
        agentId:
          type: string
          format: uuid
          description: Agent ID for agent events; link to chat when present
        clientName:
          type: string
          description: Client name for agent events; display "client --> agent"
        agentName:
          type: string
          description: Agent name for agent events; display "client --> agent"
        occurredAt:
          type: string
          format: date-time
    StatisticsEntityEventListDto:
      type: object
      required: [data, total, limit, offset]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/StatisticsEntityEventDto'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
