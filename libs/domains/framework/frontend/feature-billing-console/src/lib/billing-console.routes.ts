import { Route } from '@angular/router';
import {
  AvailabilityFacade,
  availabilityReducer,
  BackordersFacade,
  backordersReducer,
  cancelBackorder$,
  cancelSubscription$,
  checkAvailability$,
  checkAvailabilityAlternatives$,
  createInvoice$,
  createServicePlan$,
  createServiceType$,
  createSubscription$,
  CustomerProfileFacade,
  customerProfileReducer,
  deleteServicePlan$,
  deleteServiceType$,
  InvoicesFacade,
  invoicesReducer,
  loadBackorders$,
  loadBackordersBatch$,
  loadCustomerProfile$,
  loadInvoices$,
  loadInvoicesSummary$,
  loadOpenOverdueInvoices$,
  loadProviderDetails$,
  loadServicePlan$,
  loadServicePlans$,
  loadServicePlansBatch$,
  loadServiceType$,
  loadServiceTypes$,
  loadServiceTypesBatch$,
  loadSubscription$,
  loadSubscriptions$,
  loadSubscriptionsBatch$,
  previewPricing$,
  resumeSubscription$,
  retryBackorder$,
  ServicePlansFacade,
  servicePlansReducer,
  ServiceTypesFacade,
  serviceTypesReducer,
  SubscriptionsFacade,
  subscriptionsReducer,
  SubscriptionServerInfoFacade,
  subscriptionServerInfoReducer,
  loadOverviewServerInfo$,
  restartServer$,
  startServer$,
  stopServer$,
  updateCustomerProfile$,
  updateServicePlan$,
  updateServiceType$,
} from '@forepath/framework/frontend/data-access-billing-console';
import { authGuard, identityAuthProviders, identityAuthRoutes } from '@forepath/identity/frontend';
import { provideEffects } from '@ngrx/effects';
import { provideState } from '@ngrx/store';
import { BillingConsoleContainerComponent } from './container/container.component';
import { billingAdminGuard } from './guards/billing-admin.guard';
import { InvoicesComponent } from './invoices/invoices.component';
import { OverviewComponent } from './overview/overview.component';
import { ServicePlansPageComponent } from './service-plans-page/service-plans-page.component';
import { ServiceTypesPageComponent } from './service-types-page/service-types-page.component';
import { SubscriptionsComponent } from './subscriptions/subscriptions.component';

export const billingConsoleRoutes: Route[] = [
  {
    path: '',
    component: BillingConsoleContainerComponent,
    children: [
      {
        path: '',
        redirectTo: 'dashboard',
        pathMatch: 'full',
      },
      // Identity auth routes (login, register, password reset, email confirmation, user management)
      ...identityAuthRoutes,
      {
        path: 'dashboard',
        pathMatch: 'full',
        canActivate: [authGuard],
        component: OverviewComponent,
        title: 'Overview | Billing',
      },
      {
        path: 'subscriptions',
        canActivate: [authGuard],
        component: SubscriptionsComponent,
        title: 'Plans | Billing',
      },
      {
        path: 'invoices',
        canActivate: [authGuard],
        component: InvoicesComponent,
        title: 'Invoices | Billing',
      },
      {
        path: 'administration',
        children: [
          {
            path: 'service-types',
            canActivate: [authGuard, billingAdminGuard],
            component: ServiceTypesPageComponent,
            title: 'Service Types | Billing',
          },
          {
            path: 'service-plans',
            canActivate: [authGuard, billingAdminGuard],
            component: ServicePlansPageComponent,
            title: 'Service Plans | Billing',
          },
        ],
      },
      {
        path: '**',
        redirectTo: '',
      },
    ],
    providers: [
      ...identityAuthProviders,
      SubscriptionsFacade,
      SubscriptionServerInfoFacade,
      ServicePlansFacade,
      ServiceTypesFacade,
      InvoicesFacade,
      BackordersFacade,
      CustomerProfileFacade,
      AvailabilityFacade,
      provideState('subscriptions', subscriptionsReducer),
      provideState('servicePlans', servicePlansReducer),
      provideState('serviceTypes', serviceTypesReducer),
      provideState('invoices', invoicesReducer),
      provideState('backorders', backordersReducer),
      provideState('customerProfile', customerProfileReducer),
      provideState('availability', availabilityReducer),
      provideState('subscriptionServerInfo', subscriptionServerInfoReducer),
      provideEffects({
        loadSubscriptions$,
        loadSubscriptionsBatch$,
        loadSubscription$,
        createSubscription$,
        cancelSubscription$,
        resumeSubscription$,
        loadProviderDetails$,
        loadServiceTypes$,
        loadServiceTypesBatch$,
        loadServiceType$,
        createServiceType$,
        updateServiceType$,
        deleteServiceType$,
        loadServicePlans$,
        loadServicePlansBatch$,
        loadServicePlan$,
        createServicePlan$,
        updateServicePlan$,
        deleteServicePlan$,
        loadInvoices$,
        loadInvoicesSummary$,
        loadOpenOverdueInvoices$,
        createInvoice$,
        loadBackorders$,
        loadBackordersBatch$,
        retryBackorder$,
        cancelBackorder$,
        loadCustomerProfile$,
        updateCustomerProfile$,
        checkAvailability$,
        checkAvailabilityAlternatives$,
        previewPricing$,
        loadOverviewServerInfo$,
        startServer$,
        stopServer$,
        restartServer$,
      }),
    ],
  },
];
